## 因果推断
### 因果性与相关性
- **因果性**，指在改变$X$后，$Y$也随之改变。
- **相关性**，指在观测到的数据分布中$X$和$Y$相关，由此我们可以通过观测其中一个的分布得到另一个的分布。

### 识别因果关系的必要性
- 因果关系可为决策提供指导
- ABtest在某些方面有局限。（药物的有效性、政策的有效性、推荐算法的有效性）

### 因果推断的主要方法
#### 随机试验Randomization
- A/B test
- 多臂老虎机（强化学习的一种方法，随机选择动作，选择收益最高的动作）
#### 自然实验Natural Experiments
自然实验是一种观察性研究，理想的自然实验需要至少包含一下三个中的两种
- 随机分组（可以理解为特征的值是随机分配的）
- 人为干预
- 结果比较

自然实验的主要方法：
- 断点回归Regression Discountinuity
  - 观察在断点处是否出现断层。
- 工具变量Instrumental Variables
  - 要判断$X,Y$之间的因果关系，表示为$X+\epsilon\rightarrow Y$, 其中$\epsilon$为误差项，表示其他因素的影响或随机误差，可以找到一个与$X$有关而与误差无关的变量$Z$使得，由$Z$引起$X$变化的部分与误差项无关。

#### Conditioning
- 分层Stratification
  - step1，绘制变量之间的因果图
  - step2，选择影响因果性变量的条件变量
  - step3，对用户分层，满足组内条件变量的取值一致
  - step4，比较组与组的输出，计算因果效应
- 倾向得分匹配Propensity score matching
  - step1，绘制变量之间的因果图
  - step2，选择影响因果性变量的条件变量
  - step3，对用户分层，满足组内倾向得分接近
  - step4，比较组与组的输出，计算因果效应

### 因果推断方法适用场景

|方法|适用场景|
|:--:|:--:|
|合成控制|有对照组、候选样本多、样本方差较大|
|DID|有对照组、样本方差较小|
|时间序列分析|无对照组、无法构建对照组|
|断点回归|无对照组、干预时间点一致|
|工具变量法|无对照组、存在协变量|
|PSM|无对照组、存在干预前协变量|

## 实战代码

### pylift

### causalml

### EconML


### doubleml

### scikit-uplift